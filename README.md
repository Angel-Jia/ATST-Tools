# ase-neb-abacus
NEB or CI-NEB workflow by ASE and ABACUS using ASE-ABACUS interfaces,
Which use enhanced NEB method in ASE, like Dynamic NEB `DyNEB`, improved-tangent method `IT-NEB`, and also `AutoNEB` in ASE.  

Version v1.0

## Dependencies:
- [ASE](https://wiki.fysik.dtu.dk/ase/about.html)
- [ABACUS](https://abacus.deepmodeling.com/en/latest/)
- [ASE-ABACUS interfaces](https://gitlab.com/1041176461/ase-abacus)
- [GPAW](https://wiki.fysik.dtu.dk/gpaw/install.html) if one wants to run NEB images relaxation in parallel


## Usage
The workflow is based on 3 main python scripts and 1 workflow submit script. Namely:

- `neb_make.py` will make initial guess for NEB calculation, which is based on ABACUS (and other calculator) output files of initial and final state. This script will generate `init_neb_chain.traj` for neb calculation. You can get more usage by `python neb_make.py`
- `neb_run.py` is the key running script, which will run NEB calculation based on `init_neb_chain.traj` generated by `neb_make.py`. This script will generate `neb_chain.traj` for neb calculation. Users should edit this file to set parameters for NEB calculation. sereal running can be performed by `python neb_run.py`, while parallel running can be performed by `mpirun gpaw python neb_run.py`.
When running, the NEB trajectory will be output to `neb_chain.traj`, and NEB images calculation will be doing in `NEB-rank{i}` for each rank which do calculation of each image. 
- `neb_post.py` will post-process the NEB calculation result, which will generate `neb_chain.traj` for neb calculation. Users should edit this file to set parameters for NEB calculation.
- `neb_submit.sh` will do all neb process in one workflow scripts and running neb calculation in parallel. Users should edit this file to set parameters for NEB calculation. Also this submit script can be used as a template for job submission in HPC. the Default setting is for `slurm` job submission system.
- `autoneb_run.py` is the key running script for `AutoNEB` method, which is like `neb_run.py` but the I/O logic have much difference. This script is still in developing and testing. Users can try it with `mpirun gpaw python autoneb_run.py`.

Users can run each step respectively: 
1. `python neb_make.py [INIT/result] [FINAL/result] [nmax]` to create initial guess of neb chain
2. `python neb_run.py` or `mpirun -np [nprocs] gpaw python neb_run.py` to run neb calculation
3. `python neb_post.py` to post-process neb calculation result

Also, user can run each step in one script `neb_submit.sh` by `bash neb_submit.sh` or `sbatch neb_submit.sh`.

> Notice: Before you start neb calculation process, make sure that you have check the nodes and cpus setting in `neb_submit.sh` and `neb_run.py` to make sure that you can reach the highest performance !!! 

## Method
- For serial NEB calculation, DyNEB, namely dynamic NEB method `ase.mep.neb.DyNEB` is for default used.
- For parallel NEB calculation, `ase.mep.neb.NEB` traditional method is for default used, and `AutoNEB` method is independent and in development. 
- The Improved Tangent NEB method `IT-NEB` and Climbing Image NEB method `CI-NEB` in ASE are also default used in this workflow, which is highly recommended by Sobervea. 
- Users can change lots of parameter for different NEB setting. one can refer to [ASE NEB calculator](https://wiki.fysik.dtu.dk/ase/ase/neb.html#module-ase.neb) for more details: 
- Notice: in surface calculation and hexangonal system, the vaccum and c-axis should be set along y-direction but not z-direction, which is much more efficient for ABACUS calculation.


## Examples
- Li-diffu-Si: Li diffusion in Si, an example for running ASE-NEB-ABACUS based on existing ABACUS input files of initial and final state, using ABACUS as SCF calculator and ASE as optimizer and NEB calculator.  Also, an dflow example is proposed.
- H2-Au111: H2 dissociation on Au(111) surface, an example for running ASE-NEB-ABACUS based on existing ABACUS input files of initial and final state, use ABACUS as SCF calculator,use ASE for initial and final state optimization and use ASE as NEB calculator. 
- N2-Cu111 : N2 dissociation on Cu(111) surface, an example for running ASE-NEB-ABACUS based on existing ABACUS input files of initial and final state, use ABACUS as SCF calculator, use ABACUS as optimizer for optimization of initial state and final state, use ASE as NEB calculator
- CO-Pt111 : CO dissociation on Pt(111) surface, an example for running ASE-NEB-ABACUS based on existing ABACUS input files of initial and final state, use ABACUS as SCF calculator, use ABACUS as optimizer for optimization of initial state and final state, use ASE as NEB calculator
- Cy-Pt_graphene: Cyclohexane dehydrogenation on Pt-doped graphene surface, an example for running ASE-NEB-ABACUS based on existing ABACUS input files of initial and final state, use ABACUS as optimizer for optimization of initial state and final state, use ASE as NEB calculator


## Next Examples
- `AutoNEB` implementation and test 
- TS of MTM process by H2O2 in Cu/Ag-ZSM5 system, including:
- - proton transfer process
- - CH4 dissociation process
- - CH3OH generation process
- - H2O2 dissociation process
- CO-Fe100: CO dissociation on Fe(100) surface, in this example we will focus on setting `magmom` during NEB calculation, which is important for spin-polarized magnetic system.
- K2O-diffu-Fe5C2-510: K2O or K diffusion on Fe5C2(510) surface, 
- FTS Fe5C2-510: FTS process on Fe5C2(510) surface. Which is the final goal, including
- - C vacancy generation process
- - CO and H2 dissocation process
- - C-C coupling process


## Developing
- [x] Use interface to read ABACUS STRU file and ABACUS output
- [x] Flexible input for different NEB method in ASE
- [x] `DyNEB` implementation and test
- [x] Now used optimum option: idpp-guess + IT-NEB + CI-NEB parallel method
- [x] Make bottom atom fixed when read from `running*.log` of ABACUS
- [x] Give an initial guess print-out of NEB images
- [x] Decoupling to init-guess -> NEB calculation -> result post-process
- [x] More test in surface reaction system
- [x] Parallel computing during images relaxation by `gpaw python`
- [ ] `AutoNEB` implementation
- [ ] More test in magnetic surface reaction system


